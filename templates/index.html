<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>LAN Control Panel</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #e5e7eb;

      {% if cfg.bg_mode == 'image' %}
        background-image: url("{{ cfg.bg_image }}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      {% else %}
        background: {{ cfg.bg_color }};
      {% endif %}
}

    header {
      background: #020617;
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #1e293b;
    }

    header h1 {
      margin: 0;
      font-size: 1.8em;
      color: #38bdf8;
    }

    main {
      padding: 30px;
      max-width: 1100px;
      margin: auto;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .status {
      font-weight: bold;
      margin-bottom: 15px;
    }

    .on {
      color: #22c55e;
    }

    .off {
      color: #ef4444;
    }

    .actions a {
      display: inline-block;
      margin-right: 8px;
      margin-bottom: 8px;
      padding: 8px 14px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9em;
      color: #020617;
      background: #38bdf8;
    }

    .actions a.off-btn {
      background: #f97316;
    }

    .actions a.del-btn {
      background: #ef4444;
      color: white;
    }

    .actions a:hover {
      opacity: 0.85;
    }

    .add-box {
      margin-top: 40px;
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 12px;
      padding: 20px;
    }

    .add-box h2 {
      margin-top: 0;
    }

    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    input, button {
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 0.9em;
    }

    input {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #1e293b;
    }

    button {
      background: #22c55e;
      color: #020617;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    footer {
      text-align: center;
      padding: 15px;
      font-size: 0.8em;
      color: #64748b;
    }
  </style>
</head>

<body>

<header>
  <h1>üåê LAN Control Panel</h1>
  <a href="/settings"
     title="Changer le fond"
     style="
       position: fixed;
       top: 14px;
       right: 14px;
       font-size: 22px;
       text-decoration: none;
       background: rgba(0,0,0,0.55);
       padding: 8px 10px;
       border-radius: 10px;
       z-index: 1000;
     ">
    üñºÔ∏è
  </a>
</header>

<main>

  <div class="grid">
    {% for m in machines %}
    <div class="card">
      <h2>{{ m.name }}</h2>

      {% if m.status == 'ON' %}
	<div class="status on">üü¢ EN LIGNE</div>
      {% else %}
	<div class="status off">üî¥ HORS LIGNE</div>
      {% endif %}
      <img src="/history/{{ m.name | replace(' ', '_') }}.svg"
         alt="Historique"
         style="margin-top:10px; width:100%; height:40px; object-fit:contain; image-rendering:crisp-edges; background:rgba(2,6,23,0.6); border-radius:6px;">

      <div class="actions">
        <a href="/wake/{{ m.name }}">Allumer</a>
        <a href="/shutdown/{{ m.name }}" class="off-btn">√âteindre</a>
        <a href="/delete/{{ m.name }}" class="del-btn">Supprimer</a>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="add-box">
    <h2>‚ûï Ajouter une machine</h2>

    <form method="post" action="/add">
      <input name="name" placeholder="Nom">
      <input name="ip" placeholder="IP">
      <input name="mac" placeholder="MAC">
      <input name="ssh_user" placeholder="Utilisateur SSH">
      <button>Ajouter</button>
    </form>
  </div>

</main>

<footer>
  Raspberry Pi ‚Ä¢ DietPi ‚Ä¢ Tailscale ‚Ä¢ Flask
</footer>

</body>
</html>
